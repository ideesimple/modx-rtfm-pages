a:5:{s:2:"id";s:8:"36634885";s:4:"info";a:4:{s:6:"Title:";s:25:"Hardening MODX Revolution";s:7:"Author:";s:17:"Everett Griffiths";s:16:"Last Changed by:";s:17:"Everett Griffiths";s:12:"Wiki Markup:";s:40:"[revolution20:Hardening MODX Revolution]";}s:6:"parent";s:8:"36634874";s:6:"source";s:18749:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out and exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate Microsoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).  Hardening older Windows systems is a herculean effort and unless you are _extremely_ skilled and vigilant, your pre-Vista computer will likely contain severe security holes.

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose long, randomly generated passwords and update them regularly.  Longer passwords are usually more mathematically complex than shorter passwords, even if your passwords use special characters.  [Salting|http://en.wikipedia.org/wiki/Salt_(cryptography)] your passwords with a easily-remembered phrase to increase the password length is a good technique to reduce the odds of a brute-force attack succeeding.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited!

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-rhguxeeudi6n6uef1je8umgyn.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";s:8:"versions";a:28:{i:0;a:3:{s:2:"id";s:8:"36634885";s:3:"ver";s:1:"2";s:4:"code";s:18749:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out and exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate Microsoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).  Hardening older Windows systems is a herculean effort and unless you are _extremely_ skilled and vigilant, your pre-Vista computer will likely contain severe security holes.

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose long, randomly generated passwords and update them regularly.  Longer passwords are usually more mathematically complex than shorter passwords, even if your passwords use special characters.  [Salting|http://en.wikipedia.org/wiki/Salt_(cryptography)] your passwords with a easily-remembered phrase to increase the password length is a good technique to reduce the odds of a brute-force attack succeeding.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited!

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-rhguxeeudi6n6uef1je8umgyn.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:1;a:3:{s:2:"id";s:8:"37683727";s:3:"ver";s:1:"2";s:4:"code";s:18748:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate Microsoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).  Hardening older Windows systems is a herculean effort and unless you are _extremely_ skilled and vigilant, your pre-Vista computer will likely contain severe security holes.

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose long, randomly generated passwords and update them regularly.  Longer passwords are usually more mathematically complex than shorter passwords, even if your passwords use special characters.  [Salting|http://en.wikipedia.org/wiki/Salt_(cryptography)] your passwords with a easily-remembered phrase to increase the password length is a good technique to reduce the odds of a brute-force attack succeeding.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited!

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-rhguxeeudi6n6uef1je8umgyn.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:2;a:3:{s:2:"id";s:8:"37683591";s:3:"ver";s:1:"2";s:4:"code";s:18408:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate Microsoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).  Hardening older Windows systems is a herculean effort and unless you are _extremely_ skilled and vigilant, your pre-Vista computer will likely contain severe security holes.

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-rhguxeeudi6n6uef1je8umgyn.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:3;a:3:{s:2:"id";s:8:"37683589";s:3:"ver";s:1:"2";s:4:"code";s:18233:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-rhguxeeudi6n6uef1je8umgyn.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:4;a:3:{s:2:"id";s:8:"37683243";s:3:"ver";s:1:"2";s:4:"code";s:18234:"\\

{toc}

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-ghpegeuy8g3jf2gi6j2fds1rwq.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:5;a:3:{s:2:"id";s:8:"37683242";s:3:"ver";s:1:"2";s:4:"code";s:18227:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.


h2. Forcing SFTP Access

The kosher dictum here is &quot;NEVER USE FTP.&quot;  If your server doesn&#39;t support SFTP, find a different host. Period.  Even shared hosts will have a shared certificate that you can use to access your sites securely.

h2. Adding an SSL Certificate to your Manager

Sending usernames and passwords via plaintext is silly: any fool hacker with an ounce of dedication can intercept them.  If security is a priority, you should *always* access your MODX manager via a secure connection (i.e. via [HTTPS|http://en.wikipedia.org/wiki/HTTP_Secure]). 

h3. Using a shared Certificate

Just like with FTP, if your site is on a shared host, you can often piggyback on your host&#39;s shared certificate.  That makes for ugly URLs, but please ladies and gentlemen: do not be so superficial as to put URL aesthetics above your security.  


Talk to your web host for specific instructions here, but to give you an idea, sometimes, you can use a URL that features your host&#39;s name or IP and your username, e.g. 

{code}
https://myhost.com/~myuser/manager
https://127.0.0.1/~myuser/manager
{code}

127.0.0.1 is just an example IP address, and surely you&#39;ve already changed your default &quot;manager&quot; URL, no?

h3. Using a self-signed Certificate

The piggy-back option works in a pinch, but for any serious site, you&#39;ll want to install your own SSL certificate, so then we have to talk about IP addresses: *you must have a unique IP address to install an SSL certificate*.  You can create your own self-signed certificate so long as you have a unique IP address.  Multiple non-secure HTTP connections can be shared across a single IP address, but a secure HTTPS connection requires its own dedicated IP address.  Most hosting providers will offer a unique IP address for an additional fee (usually an extra couple dollars per month).

Once you have a dedicated IP address (and _only then_), you can install an SSL certificate.  But now you face another dilemma: what kind?  

The cheapest option is to use your own [self-signed certificate|http://en.wikipedia.org/wiki/Self-signed_certificate].  Technically, it&#39;s every bit as secure as the ones you pay for, but due to the nature of &quot;trust&quot; and how internet browsers are programmed, your self-signed certificates will throw warnings in browsers:

!https://img.skitch.com/20111231-ghpegeuy8g3jf2gi6j2fds1rwq.jpg|border=1!

Why?  Because nobody knows who you are.  And who are you to sign your own certificate?  The technology in place is the same no matter who signs your certificate, but the fact that you are not one of the trusted few entities that sign certificates, your browser will curse at you, and for good reason.  Remember the [Arab Spring|http://en.wikipedia.org/wiki/Arab_Spring]?  In Syria, the government issued [fake SSL certificates|http://www.onthemedia.org/2011/may/20/syrias-digital-crackdown/transcript/] in order to spy on protesters&#39; Facebook accounts.  The morale of the story: if your browser says the certificate might be forged, run away.  But if *you know* that YOU signed this certificate, then you can trust yourself.  And if your clients trust you, you can instruct them to ignore that browser message.

Do you understand what you&#39;re up against?  It&#39;s a legitimate solution in certain situations.  If it&#39;s just you on this hobby-horse, load up!  Install a self-signed certificate!  The exact instructions here depend on your server, but here&#39;s a tutorial for Open SSL: [click here|http://www.akadia.com/services/ssh_test_certificate.html].

h3. Install a &quot;Real&quot; Certificate

If the browser warnings are not acceptable for you or your clients, you need to be willing to spend a little money.  Prices on SSL certificates vary *wildly* (really, really crazy here), so shop around.  Seriously, the difference here are jaw-dropping, and the practical differences are hard to distinguish, so here&#39;s some links to get you started:

* [Thawte|http://www.thawte.com/ssl/index.html]
* [EV|http://www.digicert.com/ev-ssl-certification.htm]
* [Verisign|http://www.verisign.com/ssl/]
* [Positive SSL|http://www.positivessl.com/]
* [GeoTrust|http://www.geotrust.com/]
* [Comodo|http://www.comodo.com/business-security/digital-certificates/ssl-certificates.php]

Whether you generate a .crt file yourself or you buy one, you&#39;ll have to install install it on your server, but that&#39;s the gold at the end of the rainbow: one way or another, that makes your connection encrypted.  Once you _can_ access your site via a secure connection, you _must_ configure the manager to force secure connections.  

h3. Forcing SSL connections to the Manager

Once you&#39;ve got your site hooked up to use HTTPS, you need to force the manager to use SSL.  First, you should confirm that both http://yoursite.com/ AND https://yoursite.com/ both work (browser warnings depending on what kind of certificate you&#39;ve installed).

Once you&#39;ve verified that HTTPS works, you can now modify your .htaccess file to force all connections to the manager to occur over port 443 (i.e. over a secure connection).

Inside your manager&#39;s folder (which you&#39;ve changed by now from the default /manager/ directory), you should edit your */manager/.htaccess* file to force a secure connection.  

Here is a sample *.htaccess* file to put inside your manager directory:

{code}
RewriteEngine On
RewriteBase /
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://yoursite.com/manager/$1
{code}

Test this by trying to navigate to the non-secure url, e.g. http://yoursite.com/manager -- if it doesn&#39;t redirect to HTTPS, you&#39;ll have to tweak the .htaccess.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:6;a:3:{s:2:"id";s:8:"37683241";s:3:"ver";s:1:"2";s:4:"code";s:12522:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Note that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  Changing the directory names is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

The Advanced Distribution allows you to specify the names and locations of the various directories during the install, but it won&#39;t install successfully on some hosts.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:7;a:3:{s:2:"id";s:8:"37126192";s:3:"ver";s:1:"2";s:4:"code";s:12324:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution makes it fairly easy to change the names of its various folders and move the core outside the web root. Not that only the core can (and should) be moved outside the web root because the other directories must be accessible via the web.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:8;a:3:{s:2:"id";s:8:"37126190";s:3:"ver";s:1:"2";s:4:"code";s:12146:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than [WPA2|http://en.wikipedia.org/wiki/Wpa2#WPA2] encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:9;a:3:{s:2:"id";s:8:"37126176";s:3:"ver";s:1:"1";s:4:"code";s:12114:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).  Remember that a big part of hacking is [social engineering|http://en.wikipedia.org/wiki/Social_engineering_(security)] -- you want to make it virtually impossible for someone to guess your admin user name.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if scanner looks for a known vulnerability at http://yoursite.com/malicious/hack, and the request comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.  The best ones will monitor specific files and report any changes made to them.  If your index.php suddenly changed, then that might indicate that somebody maliciously modified it.

";}i:10;a:3:{s:2:"id";s:8:"37126174";s:3:"ver";s:1:"1";s:4:"code";s:11666:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.  It&#39;s far better to write your passwords in a notebook that you keep in a locked filing cabinet than it is to keep them in a plaintext file on your computer.

Very important: *never use the same password twice.*  Frequently hacks succeed because one service is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if http://yoursite.com/malicious/hack comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:11;a:3:{s:2:"id";s:8:"37126172";s:3:"ver";s:1:"1";s:4:"code";s:11503:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

If possible, use _only_ wired connections (no Wifi).  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: *never use the same password twice.*  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if http://yoursite.com/malicious/hack comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:12;a:3:{s:2:"id";s:8:"37126170";s:3:"ver";s:1:"1";s:4:"code";s:11490:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is almost a death-wish. This isn&#39;t just indiscriminate MicroSoft bashing, it&#39;s because it literally took MicroSoft _twenty-some years_ to finally build a system whose security policy was &quot;default-deny&quot; instead of &quot;default-permit&quot; (read more [here|http://en.wikipedia.org/wiki/Security_engineering]).

But don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: *never use the same password twice.*  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if http://yoursite.com/malicious/hack comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:13;a:3:{s:2:"id";s:8:"37126168";s:3:"ver";s:1:"1";s:4:"code";s:11178:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: *never use the same password twice.*  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.


h3. Set up a dedicated 404 page

Don&#39;t just point your 404 page to your homepage.  Set up a dedicated 404 page.  We don&#39;t want our site to get any undue attention because a scanner thinks that you have a page on your site that you do not.  E.g. if http://yoursite.com/malicious/hack comes back as an HTTP 200, then the scanner might think that you actually have that vulnerable file on your site, and it will attract other hacks or scans.  You can use the FireFox &quot;Web Developer&quot; add-on (or several others) to view page headers and verify that 404s are actually 404s.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:14;a:3:{s:2:"id";s:8:"36635036";s:3:"ver";s:1:"1";s:4:"code";s:10590:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.

Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:15;a:3:{s:2:"id";s:8:"36634945";s:3:"ver";s:1:"1";s:4:"code";s:10628:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h3. Change your Login Page

Ideally, you should also mask your manager login page so it&#39;s not obvious that you&#39;re running MODX.  At a minimum, you should remove any MODX branding from your manager login form.  See the page on [Manager Templates|http://rtfm.modx.com/display/revolution20/Manager+Templates+and+Themes] for more information.  


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:16;a:3:{s:2:"id";s:8:"36634924";s:3:"ver";s:1:"1";s:4:"code";s:10410:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type, and if you make the mistake of using the same password on more than one site, it won&#39;t take long for Pandora&#39;s box to open.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Use a unique name for the Admin User

If your admin username is hard to guess, it will slow down any attempt at a brute-force hack.  A randomly generated series of characters would make for the most secure username.  Never use a name that is easy to guess (do not use a username like *admin*, *manager*, or a name that matches the site&#39;s name -- they&#39;re too easy to guess).

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:17;a:3:{s:2:"id";s:8:"36634904";s:3:"ver";s:1:"1";s:4:"code";s:10023:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords.

NEVER use a public computer: for all you know, that computer is logging every username and password you type, and if you make the mistake of using the same password on more than one site, it won&#39;t take long for Pandora&#39;s box to open.

h3. Your Connection

Use wired connections only if possible.  Never use public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.  

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:18;a:3:{s:2:"id";s:8:"36634902";s:3:"ver";s:1:"1";s:4:"code";s:9812:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Run as a user with limited permissions and keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:19;a:3:{s:2:"id";s:8:"36634900";s:3:"ver";s:1:"9";s:4:"code";s:9769:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Path Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.


h3. Changing Default Database Prefixes

This is best done when you first install MODX, but it&#39;s always a good habit to avoid the defaults and choose a custom database prefix for your tables instead of the default *modx_* prefix.  If a hacker is somehow able to issue arbitrary SQL commands via a SQL injection attack, using custom table prefixes will make the attack just that much more difficult.

h3. Force a Password Policy

Delete any stagnant users from your site (e.g. if you created a login for a developer when you first setup the site, be sure to deactivate that user once his/her work is done).  Ensure that each user is using a complex password.



h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:20;a:3:{s:2:"id";s:8:"36634899";s:3:"ver";s:1:"8";s:4:"code";s:9099:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/4ssetsh3r3/&#39;;
$modx_assets_url = &#39;/4ssetsh3r3/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:21;a:3:{s:2:"id";s:8:"36634897";s:3:"ver";s:1:"7";s:4:"code";s:9097:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks. 

Update your server and its technologies often!  If any weak link is discovered in any part of your server, it could be the crack in the dam that floods your entire site with a world of hurt.  Keep your server patched!


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_assets_url = &#39;/0therp4th/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:22;a:3:{s:2:"id";s:8:"36634896";s:3:"ver";s:1:"6";s:4:"code";s:8877:"\\

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks.


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_connectors_url = &#39;/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
$modx_assets_url = &#39;/0therp4th/&#39;;
{code}

Again, this could potentially live on another domain (e.g. one optimized to serve up static content).


h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

";}i:23;a:3:{s:2:"id";s:8:"36634894";s:3:"ver";s:1:"5";s:4:"code";s:8702:"\\

IN PROGRESS ... 

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks.


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

Very important: never use the same password twice.  Frequently hacks succeed because one servie is compromised and the password deciphered, and a user has ignorantly or lazily used the same password for other sites or services.  *DO NOT BE LAZY!!!*

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}
";}i:24;a:3:{s:2:"id";s:8:"36634892";s:3:"ver";s:1:"4";s:4:"code";s:8452:"\\

IN PROGRESS ... 

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

Make sure that your server has a good firewall installed and some form of intrusion detection that dynamically detects hacking attempts.  [ModSecurity|http://rtfm.modx.com/display/revolution20/Installation+on+a+server+running+ModSecurity] is a security module for Apache, and it helps deter any number of malicious attacks.


h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}
";}i:25;a:3:{s:2:"id";s:8:"36634890";s:3:"ver";s:1:"3";s:4:"code";s:8126:"\\

IN PROGRESS ... 

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Everything but MODX

There are *many* aspects to hardening that have nothing to do with MODX.  We make perfunctory mention of them here, but this page is focused specifically on how to harden MODX.  A thorough security audit will focus on the entire environment, so do not neglect to consider the following aspects:

h3. Your Computer

Using any version of Windows prior to Windows Vista is a death-wish, but don&#39;t be fooled: _ANY_ operating system can be hacked. Don&#39;t think you&#39;re impervious if you&#39;re on a Mac or pushing the Penguin.  Keep your system patched and run dynamic intrusion detection software to protect you from key-loggers or screen-capture viruses.  Never save your passwords or other login info as plain text, use secure software like [LastPass|https://lastpass.com/] to store your passwords and never trust a public computer.

h3. Your Connection

Use wired connections only if possible.  Avoid any public Wifi, and never use a wireless connection that uses anything less than WPA2 security encryption. It&#39;s far too easy to intercept packets as they travel across a router.

h3. Your Server

No matter how secure all other elements are, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.  Turn off all unnecessary services and if possible, turn off FTP entirely in favor of SFTP.  Consider turning off password authentication entirely in favor of [SSH keyed logins|http://tipsfor.us/2009/06/15/securing-a-linux-server-ssh-and-brute-force-attacks/], and if you use an SSH key, make sure you use a complex passphrase.

h3. Passwords and Logins

Choose complex, randomly generated passwords and update them regularly.  Again, you *MUST* store your passwords securely, in some sort of encrypted format.

h3. Keep it Clean

Delete anything unnecessary from your site.  Delete any unused images or javascript files.  Especially bad are any lingering PHP scripts or god-forbid, any backups or zip files inside of your document root.  Think of your site as a sinking airship: if you don&#39;t need it, through it out before you crash and burn.  If you&#39;re not using a particular Plugin, Snippet, or template, for example, then delete its files from your server.  Just because it&#39;s not activated doesn&#39;t mean it can&#39;t be exploited.

h3. Backups

One of the most important things you can do for your web site is to set up incremental, off-site backups.  There is never a guarantee that you won&#39;t get hacked, so the best thing you can do is to ensure that at a minimum, you have backups to restore your site if and when it gets nuked.

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment, so do not neglect the previous section!

h3. Changing Default Paths

Unlike Evolution, MODX Revolution allows you to set up its various folders in any location.  This is critical if you want to avoid your site being fingerprinted and ending up on the speed-dial list of every hacker-bot out there.

Before you do any of this, make a backup of your site and your database!

h4. core

This is perhaps the most important path to change.  Move your core directory *out* of the web server&#39;s document root.  You don&#39;t want anyone poking around in there via a browser and exploiting any potential weaknesses.  One simple place to put it is simply one folder above your document root, i.e. {{~/core/}} instead of {{~/public_html/core/}}.  Once you move it, you&#39;ll have to update the following configuration details:

* core/config/config.inc.php (change the *$modx_core_path* variable)
* /config.core.php (at the site root)
* /connectors/config.core.php
* /manager/config.core.php
* The *modx_workspaces* database table -- this is best done by re-running the setup as you might do when [moving your site|http://rtfm.modx.com/display/revolution20/Moving+Your+Site+to+a+New+Server]

You&#39;ll probably want to go ahead and update the other paths, but just keep in mind that once you&#39;re done, you&#39;ll have to run the setup to ensure that all your paths are clean.

h4. manager

The manager is arguably the second most important path to change.  After all, if someone sees that you&#39;ve got a nice MODX login page at http://yoursite.com/manager/ it won&#39;t take a genius to figure out that you&#39;re running MODX and the brute-force hacking attempts can begin.

Choose a randomly generated alphanumeric bit of text to use as your new manager folder.  For maximum compatibility, it should use only lowercase letters.  Then update the *core/config/config.inc.php* file to something like the following:

{code}
$modx_manager_path = &#39;/home/youruser/public_html/r4nd0m/&#39;;
$modx_manager_url = &#39;/r4nd0m/&#39;;
{code}

Moving the manager will avoid the fingerprinting bots from easily sniffing your site out as a MODX site, but it&#39;s still possible that someone could eventually find your new manager directory (not easy, but entirely possible).  For an even more thorough solution, you could put the manager URL on a completely different domain, e.g. {{*$modx_manager_url* = &#39;http://othersite.com/r4nd0m/&#39;;}}  This would require that you have multiple domains on your server, but the advantage here is that it would really throw off attempts to hack your site because it wouldn&#39;t be clear that the 2 domains are related, but it would require far more sysadmin work to make this type of setup work.  

You can also lock down access to the manager by configuring your server and/or its firewall to allow access to the manager url from specific IP addresses.  E.g. if your site is only accessed by workers in an office, you could configure your server to deny requests from outside the office&#39;s IP addresses.  Another tactic would be to put an .htaccess password on the manager directory.  This would mean that users would have to enter 2 separate passwords before entering the MODX manager.  Perhaps that&#39;s not convenient, but it is more secure.

h4. connectors

Just as with the manager directory, choose a random alphanumeric name for your *connectors* directory, and then update your core/config/config.inc.php to reflect the new location, e.g.

{code}
$modx_connectors_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}

As with the manager, this could also potentially live on a separate domain.

h4. assets

The assets URL can be changed, but this is the lowest priority change because anyone visiting your site will be able to examine the source HTML and see the paths to this directory.  But it&#39;s good to change anyway, simply to confuse any efforts at fingerprinting.

h3. Followup

After changing all these paths, save the new locations in a secure place (as with your passwords), and then re-run the MODX setup utility to ensure that everything was set correctly.

Doing this will make your site more secure, but updating your site will become more complex: you will have to merge the various component directories one at a time for each MODX update.

h2. Monitoring your Site and Server

Once you&#39;ve locked down your site and server, you&#39;ll benefit from regular monitoring of it.  There are some free services available.

{code}
$modx_assets_path = &#39;/home/youruser/public_html/0therp4th/&#39;;
{code}
";}i:26;a:3:{s:2:"id";s:8:"36634888";s:3:"ver";s:1:"2";s:4:"code";s:1240:"\\

IN PROGRESS ... 

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Your Computer


h2. Your Connection


h2. Your Server

No matter how secure your MODX installation is, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.

h2. Passwords and Logins

Update them regularly.

h2. Keep it Clean

h2. Backups

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment.


h2. Monitoring your Site and Server



";}i:27;a:3:{s:2:"id";s:8:"36634886";s:3:"ver";s:1:"1";s:4:"code";s:1293:"\\

IN PROGRESS ... 

h2. Overview

Hardening any web application, including MODx Revolution, involves auditing all layers of your site, including your server, all of its services, and the application itself.  Make no mistake: it&#39;s a war out there.  If you&#39;re not afraid, then you aren&#39;t paying attention.  The simple act of having a website on-line will ensure that you will be targeted by hacks.  Their motives vary, but the weakest link will be sought out an exploited.


!Banksy.jpg|align=center,border=1!


Hardening is a huge topic, so this page seeks to help you identify what might be the most common attack vectors on your site and help you close them. 

h2. Your Computer


h2. Your Connection


h2. Your Server

No matter how secure your MODX installation is, it amounts to nothing if your server is not adequately secure.  If your FTP password is cracked, then there&#39;s nothing you can do to guarantee the integrity of your site.

h2. Passwords and Logins

Update them regularly.

h2. Keep it Clean

h2. Backups

h2. Locking down MODX

You&#39;ll notice that this is only one small section of the hardening process.  Remember: MODX is only one aspect of your environment.


h2. Monitoring your Site and Server



h2. See Also

{pagetree:root=Administering+Your+Site}";}}}